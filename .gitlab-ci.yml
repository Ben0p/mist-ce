stages:
  - test
  - build

variables:
  img: gcr.io/mist-ops/tests_base

build:
  stage: build
  script:
    - docker build --rm -t $img:$CI_COMMIT_SHA .
    - docker push $img:$CI_COMMIT_SHA
    - docker tag $img:$CI_COMMIT_SHA $img:$CI_COMMIT_REF_SLUG
    - docker push $img:$CI_COMMIT_REF_SLUG
  tags:
    - builder
