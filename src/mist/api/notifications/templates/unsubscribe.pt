<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Confirm Unsubscribe</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<style>
		body {font-family: Roboto, Noto, sans-serif; font-size: 14px;}
		h5   {font-weight: normal; font-size: 16px;}
		a {color: #0099cc; text-decoration: none;}

		.header, .content, .footer {
			width: 600px;
			margin: 0 auto;
		}

		.header {
			padding: 24px 0;
			border-bottom: 1px solid #dfdfe1;
		}

		.logo {
			width:160px;
			height: auto;
		}

		.button {
			cursor: pointer;
			display: block; 
			background-color: #0099cc; 
			color: #fff; 
			padding: 1.18rem 1.1rem 1.1rem 1.1rem; 
			font-weight: 500; 
			text-decoration: none; 
			width: 220px; 
			margin: 0 auto; 
			text-align: center; 
			text-transform: uppercase; 
			border-radius: 4px;
		}

		a.back {
			display: block;
			padding: 18px 0;
		}

		.footer {
			padding: 24px 0;
			border-top: 1px solid #dfdfe1;
			text-align: center;
		}

		.hidden {
			display: none;
		}

	</style>

	<script type="text/javascript">
		function request_unsubscribe() {
			var url = "/api/v1/unsubscribe";

			var data = {
				"token": "${token}"
			};
			var json = JSON.stringify(data);

			var xhr = new XMLHttpRequest();
			xhr.open("PUT", url, true);
			xhr.setRequestHeader('Content-type','application/json; charset=utf-8');
			xhr.setRequestHeader('Csrf-Token', '${csrf_token}');
			xhr.onload = function () {
				if (xhr.status == "200") {
					var confirm_prompt = document.getElementById("confirm");
					confirm_prompt.classList.add("hidden");
					var complete_prompt = document.getElementById("complete");
					complete_prompt.classList.remove("hidden");
				} else {
					var confirm_prompt = document.getElementById("confirm");
					confirm_prompt.classList.add("hidden");
					var error_prompt = document.getElementById("error");
					error_prompt.classList.remove("hidden");
				}
				var button = document.getElementById("unsub_button");
				button.classList.add("hidden");
			}
			xhr.send(json);
		}
		
	</script>
</head>
<body>

<div class="header">
	<div class="menu">
		<a href="${uri}"><img class="logo" src="landing/images/logo.svg"></a>
	</div>
</div>

<div class="content">
	<h5 id="confirm">
	Are you sure you want to unsubscribe from mist.io weekly reports?
	</h5>
	<h5 id="complete" class="hidden">
	You have successfuly unsubscribed from the mist.io weekly reports.
	</h5>
	<h5 id="error" class="hidden">
	An error occured.
	</h5>

	<div class="button-container">
		<div id="unsub_button" class="button" onclick="request_unsubscribe()">Unsubscribe</div>
	</div>

	<a class="back" href="${uri}">Back to mist.io</a>
</div>

<div class="footer">
	<a href="${uri}" style="text-decoration:none; color:#0099cc;">mist.io</a>, Inc  •  <a href="http://blog.mist.io" style="text-decoration:none; color:#0099cc;">Our Blog</a> <br>
							620 Folsom St  •  San Francisco, CA  •  94107
</div>

</body>
</html>
