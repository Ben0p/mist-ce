<!DOCTYPE html>
<html xmlns:tal="http://xml.zope.org/namespaces/tal">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>${project} - down to earth cloud computing</title>
    <!-- include the Tools -->
    <link rel="stylesheet" href="static/jquery.mobile-1.0.min.css" />
    <link rel="stylesheet" href="static/jqm-docs.css" />
    <script src="static/jquery-1.6.4.js"></script>
    <script src="static/jquery.mobile-1.0.min.js"></script>
    <script src="static/mist.js"></script>
    <link rel="icon" href="static/favicon.ico" />
    <link rel="stylesheet" media="all" href=""/>
</head>

<body lang="en">
    <div id="notifier-wrapper" class="soft-shadow">
        <div id="notifier" class="soft-shadow">
            <span id="notifier-hide">
                <span id="hide-icon"></span>
            </span>
            <span class="messages-count">
                <a title="expand messages">0 messages</a>
            </span>
            <span class="messages-expand">
                <a title="expand messages">Show all</a>
            </span>
            <span class="text"></span>
        </div><!-- / notifier -->

        <div id="notifier-in" style="display:none;">
        </div><!-- / notifier-in -->
    </div>

    <div id="notifier-show">
        <div id="notifier-show-icon"></div>
    </div>

    <div id="wrapper">
        <div id="header">
        </div>
        <div id="backends">
            <!-- tabs -->
            <ul class="css-tabs rounded-top drop-shadow">
                <li><a href="machines" class="medium" title="Manage your virtual machines.">machines</a></li>
                <li><a href="images" class="medium" title="Manage boot images.">images</a></li>
            </ul>
            <div class="css-panes rounded-bottom drop-shadow">
                <div id="machines-pane" style="display:block"></div>
                <div id="disks-pane" style="display:block"></div>
                <div id="images-pane" style="display:block"></div>
                <div id="networks-pane" style="display:block"></div>
            </div>
        </div>

    </div>
    <!-- activate tabs with JavaScript -->
    <script>
        $(function() {
            $("ul.css-tabs").tabs("div.css-panes div", {
                effect: 'fade',
                onBeforeClick: function(event, i) {
                    var me = this,
                        tab = me.getTabs().eq(i),
                        paneswrapper = $('.css-panes'),
                        panes = paneswrapper.children(),
                        newpane = panes.eq(i),
                        rest = panes.not(newpane).not($('.large-spinner'));

                    // Why??
                    //panes.show().fadeOut(300);

                    // This solves various transition issues, like misplaced
                    // elements. Don't ask me.
                    //panes.width(paneswrapper.width());

                    // Explicitly set height
                    paneswrapper.height(paneswrapper.height());

                    //fetch content using ajax
                    newpane.load(me.getTabs().eq(i).attr("href"), function(){
                        paneswrapper.animate({height : newpane.outerHeight(true)}, 300, function() {
                            paneswrapper.height('auto');
                        });
                        rest.html('');
                        newpane.hide().fadeIn(300);
                    });
                }
            });
        });
        $("ul.css-tabs a").tooltip({effect: 'fade', predelay: 1000, delay: 2, position: 'top center', opacity: 0.8});
        var backends = [];
        var log = new MessageLog();

        // Message Notifier
        // _________________

        //Show all messages
        $('#notifier span.messages-expand').click(function() {
            $('#notifier-in').slideToggle('slow', function() {
            var messagesHtml = '<ul class="messages">';
                for (var i = log.messages.length -1; i > -1; i--) {
                    messagesHtml += '<li class="log-message">' + log.messages[i] + '</li>';
                }
                messagesHtml += '</ul>';
                $('#notifier-in').html(messagesHtml);
            });
        });

        //updates the messages notifier
        function update_message_notifier() {
            if (log.messages[log.messages.length-1][0] < LOGLEVEL){
                clearTimeout(log.timeout);
                if (!$('#notifier-wrapper').is (':visible')){
                    $('#notifier-wrapper').slideDown(300);
                }
                var txt = log.messages[log.messages.length-1][1].toISOString() + " : " + log.messages[log.messages.length-1].slice(2).join(' - ');
                $('#notifier span.text').text(txt);
                update_messages_count();
                log.timeout = setTimeout("$('#notifier-wrapper').slideUp(300)", 5000);
            }
        }

        // Message notifier mouseenter and mouseleave events
        $('#notifier-wrapper').mouseenter(function() {
            clearTimeout(log.timeout);
        }).mouseleave(function() {
            log.timeout = setTimeout("$('#notifier-wrapper').slideUp(300)", 5000);
        });

        // update the messages counter
        function update_messages_count() {
            var message_count = log.messages.filter(function(el,i){return el[0] < LOGLEVEL}).length;
            if (message_count == 1) {
                messages = ' message';
            } else {
                messages =  ' messages';
            }
            $('#notifier span.messages-count').text(message_count + messages);
        }

        $('#notifier-show').click(function() {
            $('#notifier-wrapper').slideDown(300);
        });

        $('#notifier-hide').click(function() {
            $('#notifier-wrapper').slideUp(300);
        });

    </script>
    <script tal:repeat="backend backends" tal:content="string:backends.push(new Backend('${backend['id']}','${backend['title']}',${backend['provider']},${backend['poll_interval']},${backend.host|'undefined'}, log));" />
    <div id="footer">created by <a href="https://unweb.me" title="state of the art information systems">unweb.me</a></div>
</body>
</html>
