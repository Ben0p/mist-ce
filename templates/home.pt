<!DOCTYPE html>
<html xmlns:tal="http://xml.zope.org/namespaces/tal">

<head>
    <meta charset="utf-8">
    <meta content='True' name='HandheldFriendly' />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0" />
    <title>${project} - down to earth cloud computing</title>
    <link type="text/css" href="static/ui-smoothness/jquery-ui-1.9.1.custom.css" rel="stylesheet" />
    <link rel="stylesheet" href="static/jquery.mobile-1.3.0.css" />
    <link rel="stylesheet" href="static/main.css" />
    <link rel="icon" href="static/favicon.ico" />
    <link rel="stylesheet" media="all" href=""/>
    <script tal:content="string: var URL_PREFIX='${core_uri}'" />
    <script tal:content="string: var SUPPORTED_PROVIDERS=${supported_providers}" />
    <script tal:content="string: var LOGLEVEL=${js_log_level}" />
    <script tal:content="string: var EMAIL='${email}'" />

    <script src="static/js/lib/require/require.js"></script>

    <script tal:condition="js_build">
        require.config({
            baseUrl: 'static/js/',
            paths: {
                //the optimized mist.js source file.
                "app": "../build/mist"
            }
        });
        require(["app"]);
    </script>
    <script tal:condition="not:js_build">
        require.config({
            // not optimized js, usefull for bedugging
            baseUrl: 'static/js/'
        });
        require(["app"]);
    </script>
</head>

<body style="background-color: #c2c3c4">

<iframe id="hidden-shell-iframe"></iframe>

<script type="text/x-handlebars" data-template-name="application">
<div data-role="header">
        <h1>{{title}}</h1>
    </div>

    <div data-role="content" id="mainPage">
{{outlet}}
</div>

</script>

<script type="text/x-handlebars" data-template-name="index">

        <a id="add-backend-button"
            href="#add-backend"
            class="add-button"
            data-rel="popup"
            data-theme="b"
            data-inline="true"
            data-transition="pop"
            data-role="button"
            data-icon="plus">Add backend</a>

        <div data-role="popup" id="add-backend" class="mist-dialog" data-overlay-theme="a">
            <div data-role="header">
                <h1>Add backend</h1>
            </div>
            {{view Mist.AddBackendView backendBinding="Mist.backend"}}
        </div>

        <div data-role="controlgroup" data-type="horizontal" id="backend-buttons">
            {{#each Mist.backendsController}}
                {{view Mist.BackendButtonView backendBinding="this"}}
            {{/each}}
        </div>

        <div data-role="popup" id="edit-backend" class="mist-dialog" data-overlay-theme="a">
            <div data-role="header">
                <h1>Edit backend</h1>
            </div>
            {{view Mist.EditBackendView backendBinding="Mist.backend"}}
        </div>

        {{#if Mist.backendsController.content.length}}
        <ul data-role="listview"
            data-theme="c"
            data-dividertheme="d"
            class="ui-listview ui-listview-inset ui-corner-all ui-shadow"
            id="home-menu">
            <li>
                {{#linkTo machines}}Machines
                    {{#view Mist.CountView
                        numberBinding="Mist.backendsController.machineCount"
                        tagName="span"
                        class="ui-li-count"}}
                        {{view.number}}
                    {{/view}}
                {{/linkTo}}
            </li>
            <li>
                <a id="images-count" href="#images">Images
                    {{#view Mist.CountView
                        numberBinding="Mist.backendsController.imageCount"
                        tagName="span"
                        class="ui-li-count"}}
                        {{view.number}}
                    {{/view}}
                </a>
            </li>
            <li>
                <a id="keys-count" href="#keys">Keys
                    {{#view Mist.CountView
                        numberBinding="Mist.keysController.content.length"
                        tagName="span"
                        class="ui-li-count"}}
                        {{view.number}}
                    {{/view}}
                </a>
            </li>
        </ul>
        {{/if}}
</script>
<script type="text/x-handlebars" data-template-name="machines">

        <ul id="machines-list"
        data-role="listview"
        data-filter="true"
        data-inset="true"
        data-theme="c"
        data-filter-placeholder="Filter machines...">
            {{#each Mist.backendsController}}
                {{#each machines}}
                    {{view Mist.MachineListItemView machineBinding="this"}}
                {{/each}}
            {{/each}}
        </ul>


</script>

<script type="text/x-handlebars" data-template-name="images">
<ul id="images-list"
        data-role="listview"
        data-filter="true"
        data-inset="true"
        data-theme="c"
        data-filter-placeholder="Filter images...">
            {{#each Mist.backendsController}}
                {{#each images}}
                    {{view Mist.ImageListItemView imageBinding="this"}}
                {{/each}}
            {{/each}}
        </ul>
</script>

</body>

</html>
